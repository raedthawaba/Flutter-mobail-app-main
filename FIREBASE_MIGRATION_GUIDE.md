# ๐ฅ ุฏููู ุงูุชุฑุญูู ุฅูู Firebase

## โ ุงูุชุบููุฑุงุช ุงูุชู ุชู ุฅุฌุฑุงุคูุง

### 1. ุชุญุฏูุซ ููุฏูู ุงููุณุชุฎุฏู (`lib/models/user.dart`)

**ุงูุชุบููุฑุงุช:**
- โ ุฅุถุงูุฉ ุญูู `uid` (Firebase Auth UID)
- โ ุฅุถุงูุฉ ุญูู `email` (ูููุตุงุฏูุฉ ูุน Firebase)
- โ ุฌุนู `password` ุงุฎุชูุงุฑู (Firebase Auth ูุฏูุฑ ูููุงุช ุงููุฑูุฑ)
- โ ุฅุถุงูุฉ ุฏุงูุฉ `toFirestore()` ููุชูุงูู ูุน Firestore
- โ ุชุญุฏูุซ `fromMap()` ูุฏุนู ุชูุณููุงุช ุงูุจูุงูุงุช ุงููุฎุชููุฉ

### 2. ุฅูุดุงุก ุฎุฏูุฉ Firestore (`lib/services/firestore_service.dart`)

**ุงูููุฒุงุช:**
- โ ุงุณุชุจุฏุงู ุฌููุน ุนูููุงุช SQLite ุจู Firestore
- โ ุฏูุงู ูููุณุชุฎุฏููู (ุฅูุดุงุกุ ูุฑุงุกุฉุ ุชุญุฏูุซุ ุญุฐู)
- โ ุฏูุงู ููุดูุฏุงุก (ุฅุถุงูุฉุ ูุฑุงุกุฉุ ุชุญุฏูุซุ ุญุฐู)
- โ ุฏูุงู ููุฌุฑุญู (ุฅุถุงูุฉุ ูุฑุงุกุฉุ ุชุญุฏูุซุ ุญุฐู)
- โ ุฏูุงู ููุฃุณุฑู (ุฅุถุงูุฉุ ูุฑุงุกุฉุ ุชุญุฏูุซุ ุญุฐู)
- โ ุฏุงูุฉ ููุฅุญุตุงุฆูุงุช
- โ ุฏูุงู ุชุญููู ุงูุจูุงูุงุช ูู/ุฅูู Firestore

### 3. ุชุญุฏูุซ ุฎุฏูุฉ ุงููุตุงุฏูุฉ (`lib/services/auth_service.dart`)

**ุงูุชุบููุฑุงุช:**
- โ ุงุณุชุฎุฏุงู Firebase Authentication ุจุฏูุงู ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช ุงููุญููุฉ
- โ ุชุณุฌูู ุงูุฏุฎูู ุจุงูุจุฑูุฏ ุงูุฅููุชุฑููู ููููุฉ ุงููุฑูุฑ
- โ ุฅูุดุงุก ุญุณุงุจุงุช ุฌุฏูุฏุฉ ุนุจุฑ Firebase Auth
- โ ุชุญุฏูุซ ูููุฉ ุงููุฑูุฑ ุนุจุฑ Firebase
- โ ุฅุถุงูุฉ ุฏุงูุฉ ุฅุนุงุฏุฉ ุชุนููู ูููุฉ ุงููุฑูุฑ ุนุจุฑ ุงูุจุฑูุฏ ุงูุฅููุชุฑููู
- โ ูุนุงูุฌุฉ ุฃุฎุทุงุก Firebase Auth ุจุฑุณุงุฆู ุนุฑุจูุฉ ูุงุถุญุฉ

---

## โ๏ธ **ููู ุฌุฏุงู: ุชุบููุฑุงุช ูุฌุจ ุฅุฌุฑุงุคูุง ูู ุงูููุฏ**

### ุงููุดููุฉ:
ุงูููุฏ ุงูุญุงูู ูุณุชุฎุฏู `addedByUserId` ูู `int` ูู ุงูููุฏููุงุชุ ููู Firebase Auth ูุณุชุฎุฏู `String` (UID).

### ุงูุญู:
ูุฌุจ ุชุญุฏูุซ ุฌููุน ุงููููุงุช ุงูุชู ุชุณุชุฎุฏู `addedByUserId` ูู `int` ุฅูู `String`.

**ุงููููุงุช ุงููุชุฃุซุฑุฉ:**
1. โ `lib/services/firestore_service.dart` - **ุชู ุงูุชุนุฏูู** (ูุญูู String ุฅูู int ููุชูุงูู ุงููุคูุช)
2. โ๏ธ `lib/screens/` - **ูุญุชุงุฌ ุชุญุฏูุซ** (ุฌููุน ุงูุดุงุดุงุช ุงูุชู ุชุณุชุฎุฏู userId)
3. โ๏ธ `lib/blocs/` ุฃู `lib/cubits/` - **ูุญุชุงุฌ ุชุญุฏูุซ** (ุฅุฐุง ูุฌุฏุช)

---

## ๐ ุงูุฎุทูุงุช ุงูุชุงููุฉ ุงููุทููุจุฉ

### 1. ุฅูุดุงุก ูุณุชุฎุฏู Admin ูู Firestore

ูุธุฑุงู ูุฃู Firebase Auth ูุง ูุฏุนู ุฅูุดุงุก ูุณุชุฎุฏู ุงูุชุฑุงุถู ุนูุฏ ุงูุฅุนุฏุงุฏ ุงูุฃููุ ูุฌุจ ุฅูุดุงุก ูุณุชุฎุฏู Admin ูุฏููุงู.

#### ุงูุทุฑููุฉ ุงูุฃููู: ุนุจุฑ Firebase Console (ููุตู ุจูุง)

1. **ุงูุชุญ Firebase Console**
   - ุงุฐูุจ ุฅูู: https://console.firebase.google.com
   - ุงุฎุชุฑ ูุดุฑูุนู

2. **ุฃุถู ูุณุชุฎุฏู ูู Authentication**
   - ูู ุงููุงุฆูุฉ ุงูุฌุงูุจูุฉุ ุงุฎุชุฑ **Authentication**
   - ุงููุฑ ุนูู ุชุจููุจ **Users**
   - ุงููุฑ ุนูู **Add user**
   - ุฃุฏุฎู ุงูุจูุงูุงุช:
     - Email: `admin@palestine.com`
     - Password: `admin123456` (ุฃู ุฃู ูููุฉ ูุฑูุฑ ูููุฉ)
   - ุงููุฑ **Add user**
   - **ุงุญูุธ ุงูู UID** ุงูุฐู ุธูุฑ (ุณูุญุชุงุฌู ูู ุงูุฎุทูุฉ ุงูุชุงููุฉ)

3. **ุฃุถู ุจูุงูุงุช ุงููุณุชุฎุฏู ูู Firestore**
   - ูู ุงููุงุฆูุฉ ุงูุฌุงูุจูุฉุ ุงุฎุชุฑ **Firestore Database**
   - ุงุฎุชุฑ ูุฌููุนุฉ **users**
   - ุงููุฑ ุนูู **Add document**
   - **ููู ุฌุฏุงู:** ูู ุญูู "Document ID"ุ ุงุณุชุฎุฏู ููุณ ุงูู UID ูู ุงูุฎุทูุฉ ุงูุณุงุจูุฉ
   - ุฃุถู ุงูุญููู ุงูุชุงููุฉ:
     ```
     email: admin@palestine.com (string)
     username: admin (string)
     fullName: ุงููุณุคูู ุงูุนุงู (string)
     userType: admin (string)
     createdAt: [ุงุฎุชุฑ Timestamp ูุงุฎุชุฑ ุงูุชุงุฑูุฎ ุงูุญุงูู] (timestamp)
     phoneNumber: (ุงุฎุชูุงุฑู) (string)
     ```
   - ุงููุฑ **Save**

#### ุงูุทุฑููุฉ ุงูุซุงููุฉ: ุจุฑูุฌูุงู (ููุชุทููุฑ ููุท)

ููููู ุฅูุดุงุก ุดุงุดุฉ ูุคูุชุฉ ูุฅูุดุงุก ูุณุชุฎุฏู Adminุ ุซู ุญุฐููุง ุจุนุฏ ุงูุงุณุชุฎุฏุงู.

### 2. ุชุญุฏูุซ ุดุงุดุงุช ุชุณุฌูู ุงูุฏุฎูู ูุงูุชุณุฌูู

**ูุฌุจ ุชุญุฏูุซ:**
- `lib/screens/login_screen.dart`
- `lib/screens/register_screen.dart`

**ุงูุชุบููุฑุงุช ุงููุทููุจุฉ:**
```dart
// ูู:
await authService.login(username, password);

// ุฅูู:
await authService.login(email, password);
```

```dart
// ูู:
await authService.register(
  username: username,
  password: password,
  fullName: fullName,
);

// ุฅูู:
await authService.register(
  email: email,
  password: password,
  fullName: fullName,
  username: username, // ุงุฎุชูุงุฑู
);
```

### 3. ุชุญุฏูุซ ุงุณุชุฎุฏุงู `userId` ูู ุงูุชุทุจูู

ุงุจุญุซ ุนู ุฌููุน ุงูุฃูุงูู ุงูุชู ุชุณุชุฎุฏู `getCurrentUserId()` ูุชุฃูุฏ ูู ุฃููุง ุชุชุนุงูู ูุน `String` ุจุฏูุงู ูู `int`.

```dart
// ูู:
final userId = await authService.getCurrentUserId(); // int?

// ุฅูู:
final userId = await authService.getCurrentUserId(); // String?
```

### 4. ุงุฎุชุจุงุฑ ุงูุชุทุจูู

**ุฎุทูุงุช ุงูุงุฎุชุจุงุฑ:**
1. โ ุชุณุฌูู ูุณุชุฎุฏู ุฌุฏูุฏ
2. โ ุชุณุฌูู ุงูุฏุฎูู
3. โ ุฅุถุงูุฉ ุดููุฏ/ุฌุฑูุญ/ุฃุณูุฑ
4. โ ุนุฑุถ ุงูููุงุฆู
5. โ ุชุญุฏูุซ ุงูุจูุงูุงุช
6. โ ุญุฐู ุงูุจูุงูุงุช
7. โ ุชุณุฌูู ุงูุฎุฑูุฌ

### 5. ุชูุธูู ุงูููุฏ ุงููุฏูู (ุงุฎุชูุงุฑู)

ุจุนุฏ ุงูุชุฃูุฏ ูู ุฃู ูู ุดูุก ูุนูู ุจุดูู ุตุญูุญุ ููููู:
- ุญุฐู `lib/services/database_service.dart` (ูุงุนุฏุฉ ุงูุจูุงูุงุช ุงููุญููุฉ ุงููุฏููุฉ)
- ุฅุฒุงูุฉ ุชุจุนูุฉ `sqflite` ูู `pubspec.yaml`

---

## ๐ ููุงุนุฏ ุงูุฃูุงู ูู Firestore

**โ๏ธ ููู:** ุญุงููุงูุ ูุงุนุฏุฉ ุงูุจูุงูุงุช ูู "Test Mode" ูุชุณูุญ ุจุงููุตูู ููุฌููุน ููุฏุฉ 30 ูููุงู.

**ูุฌุจ ุชุญุฏูุซ ููุงุนุฏ ุงูุฃูุงู ูุจู ุงูุฅูุชุงุฌ!**

### ููุงุนุฏ ุงูุฃูุงู ุงูููุตู ุจูุง:

```javascript
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    
    // ููุงุนุฏ ูููุณุชุฎุฏููู
    match /users/{userId} {
      // ุงูุณูุงุญ ุจุงููุฑุงุกุฉ ูููุณุชุฎุฏู ุงููุณุฌู ููุท
      allow read: if request.auth != null && request.auth.uid == userId;
      // ุงูุณูุงุญ ุจุงููุชุงุจุฉ ูููุณุชุฎุฏู ููุณู ููุท
      allow write: if request.auth != null && request.auth.uid == userId;
      // ุงูุณูุงุญ ููุฃุฏูู ุจูุฑุงุกุฉ ูู ุงููุณุชุฎุฏููู
      allow read: if request.auth != null && 
                    get(/databases/$(database)/documents/users/$(request.auth.uid)).data.userType == 'admin';
    }
    
    // ููุงุนุฏ ููุดูุฏุงุก
    match /martyrs/{martyrId} {
      // ุงูุณูุงุญ ุจุงููุฑุงุกุฉ ููุฌููุน ุงููุณุฌููู
      allow read: if request.auth != null;
      // ุงูุณูุงุญ ุจุงูุฅุถุงูุฉ ูููุณุชุฎุฏููู ุงููุณุฌููู
      allow create: if request.auth != null;
      // ุงูุณูุงุญ ุจุงูุชุญุฏูุซ ูููุณุชุฎุฏู ุงูุฐู ุฃุถุงู ุงูุจูุงูุงุช ุฃู ุงูุฃุฏูู
      allow update, delete: if request.auth != null && 
        (resource.data.added_by_user_id == request.auth.uid ||
         get(/databases/$(database)/documents/users/$(request.auth.uid)).data.userType == 'admin');
    }
    
    // ููุณ ุงูููุงุนุฏ ููุฌุฑุญู
    match /injured/{injuredId} {
      allow read: if request.auth != null;
      allow create: if request.auth != null;
      allow update, delete: if request.auth != null && 
        (resource.data.added_by_user_id == request.auth.uid ||
         get(/databases/$(database)/documents/users/$(request.auth.uid)).data.userType == 'admin');
    }
    
    // ููุณ ุงูููุงุนุฏ ููุฃุณุฑู
    match /prisoners/{prisonerId} {
      allow read: if request.auth != null;
      allow create: if request.auth != null;
      allow update, delete: if request.auth != null && 
        (resource.data.added_by_user_id == request.auth.uid ||
         get(/databases/$(database)/documents/users/$(request.auth.uid)).data.userType == 'admin');
    }
  }
}
```

### ููููุฉ ุชุทุจูู ููุงุนุฏ ุงูุฃูุงู:

1. ุงูุชุญ Firebase Console
2. ุงุฐูุจ ุฅูู **Firestore Database**
3. ุงุฎุชุฑ ุชุจููุจ **Rules**
4. ุงูุตู ุงูููุงุนุฏ ุฃุนูุงู
5. ุงููุฑ **Publish**

---

## ๐ ููุงุฑูุฉ ุจูู SQLite ู Firestore

| ุงูููุฒุฉ | SQLite (ุงููุฏูู) | Firestore (ุงูุฌุฏูุฏ) |
|--------|----------------|-------------------|
| **ุงูุชุฎุฒูู** | ูุญูู ุนูู ุงูุฌูุงุฒ | ุณุญุงุจู (Cloud) |
| **ุงููุฒุงููุฉ** | ุบูุฑ ูุชููุฑุฉ | ุชููุงุฆูุฉ ูู ุงูููุช ุงููุนูู |
| **ุงููุตูู ูู ุฃุฌูุฒุฉ ูุชุนุฏุฏุฉ** | โ ุบูุฑ ูููู | โ ูููู |
| **ุงููุณุฎ ุงูุงุญุชูุงุทู** | ูุฏูู | ุชููุงุฆู |
| **ุงูุฃูุงู** | ูุญูู ููุท | ููุงุนุฏ ุฃูุงู ูููุฉ |
| **ุงูุฃุฏุงุก ูุน ุงูุจูุงูุงุช ุงููุจูุฑุฉ** | ูุญุฏูุฏ | ููุชุงุฒ |
| **ุงูุชูููุฉ** | ูุฌุงูู | ูุฌุงูู (ุญุชู ุญุฏ ูุนูู) |

---

## ๐ฏ ุงูุฎูุงุตุฉ

ุชู ุชุฑุญูู ุงูุชุทุจูู ุจูุฌุงุญ ูู SQLite ุฅูู Firebase! ๐

**ูุง ุชุจูู:**
1. โ ุฅูุดุงุก ูุณุชุฎุฏู Admin ูู Firestore
2. โ๏ธ ุชุญุฏูุซ ุดุงุดุงุช ุชุณุฌูู ุงูุฏุฎูู/ุงูุชุณุฌูู
3. โ๏ธ ุงุฎุชุจุงุฑ ุฌููุน ุงููุธุงุฆู
4. โ๏ธ ุชุญุฏูุซ ููุงุนุฏ ุงูุฃูุงู ูุจู ุงูุฅูุชุงุฌ

**ุฅุฐุง ูุงุฌูุช ุฃู ูุดุงููุ ุชุญูู ูู:**
- Firebase Console ููุชุฃูุฏ ูู ุฅุนุฏุงุฏ ุงููุดุฑูุน ุจุดูู ุตุญูุญ
- `android/app/google-services.json` ู `ios/Runner/GoogleService-Info.plist`
- ุงูุงุชุตุงู ุจุงูุฅูุชุฑูุช

---

## ๐ ุงููุณุงุนุฏุฉ

ุฅุฐุง ูุงุฌูุช ุฃู ูุดููุฉ:
1. ุชุญูู ูู ุณุฌูุงุช ุงูุฃุฎุทุงุก (Logs)
2. ุชุฃูุฏ ูู ุฃู Firebase ูููุฃ ุจุดูู ุตุญูุญ
3. ุฑุงุฌุน [ูุซุงุฆู Firebase](https://firebase.google.com/docs)

**ุญุธุงู ููููุงู! ๐**
